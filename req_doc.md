# 海狗公益(HiGO)AI辅助问诊API需求

## 主要功能要求

1. API调用方需要预先注册，注册后申请一个API Key，用于后续的API调用。
2. 需要根据API Key的使用情况进行计费。
3. API调用方通过API调用得到AI辅助回答的格式化文本结果。
4. API调用方调用API的场景如下：
   1. 以会话中的单条消息文本调用API，获取AI辅助回答；
   2. 以会话中的单条消息文本和消息所针对的宠物的宠物ID，调用API，获取AI辅助回答；
   3. 以会话中的单条消息文本、消息所针对的宠物的宠物ID、宠物的诊断报告图片，调用API，获取AI辅助回答；
   4. 以会话中的单条消息文本、消息所针对的宠物的宠物ID、宠物的拍照图片(面部、呕吐物、皮毛、尿液、粪便和耳道)、调用API，获取AI辅助回答；
   5. 以会话中的单条消息文本、消息所针对的宠物的宠物ID、宠物的拍照图片(面部、呕吐物、皮毛、尿液、粪便和耳道)、宠物的诊断报告图片，调用API，获取AI辅助回答。

## 针对AI辅助回答的特殊要求

1. AI的辅助回答需要调用宠物医疗垂直领域的大语言模型：“新瑞鹏宠物医疗大模型Vet1+”来获取。
2. 对于宠物的拍照图片(面部、呕吐物、皮毛、尿液、粪便和耳道)的解读，需要调用宠物医疗垂直领域的多模态模型：“汪喵灵灵宠物多模态模型vetmew”来获取。
3. AI的辅助回答必须要结合当前会话中的消息上下文。会话中的消息上下文需要保存。API调用方在调用API时，除了传入当前聊天中用户输入或上传的文字和图片外，还需要传入当前会话的ID，用于获取当前会话的上下文。
4. 在API的调用中，如果给出了宠物的宠物ID，那么AI的辅助回答必须要结合宠物自身的情况(种类、品种、性别、年龄、体重、疫苗接种情况、驱虫情况、既往病史、过敏史、家族病史等)。宠物自身的情况根据宠物ID，通过接口访问获取。
5. AI的辅助回答需根据调用API的具体场景，综合以下信息，进行统一回答：
   1. 会话中的当前消息
   2. 会话中的历史消息
   3. 宠物自身的情况
   4. 宠物的拍照图片(面部、呕吐物、皮毛、尿液、粪便和耳道)的解读
   5. 宠物的诊断报告图片的解读
6. 考虑到API的执行流程比较耗时，前端用户等待时间比较长，在API调用期间需要向被调用方返回执行的阶段和状态(比如：问题分析中，宠物信息获取中，宠物图片解读中，诊断报告解读中，生成回答中，回答完成)。

## API Key管理

1. 需要提供一个Web访问页面，供API调用方注册和管理自己的API Key；
2. API调用方注册后，申请一个API Key，用于后续的API调用；
3. API调用方可以查看和删除自己的API Key，也可以创建新的API Key；
4. API调用方可以查看自己的API Key的使用情况，包括调用次数、调用时间、调用结果等；
5. API调用方可以查看自己的API Key的计费情况、余额情况和账单。
